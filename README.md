# LinkCheck

Веб-сервер для проверки доступности ссылок. Можно отправлять ссылки на проверку и получать PDF отчеты.

## Что это делает

Сервис проверяет, доступны ли ссылки в интернете. Можно отправить одну или несколько ссылок, получить их статусы и номер набора. Также можно запросить PDF отчет по номерам ранее проверенных наборов ссылок.

## API

### Проверка ссылок

**URL:** `POST /submit`

**Запрос:**
```json
{
  "links": ["google.com", "yandex.ru"]
}
```

**Ответ:**
```json
{
  "links": {
    "google.com": "available",
    "yandex.ru": "not available"
  },
  "links_num": 1
}
```

### Получение PDF отчета

**URL:** `POST /report`

**Запрос:**
```json
{
  "links_list": [1, 2]
}
```

**Ответ:** PDF файл с отчетом о статусах всех ссылок из указанных наборов.

## Как это устроено

Проект разделен на несколько частей:

```
cmd/server/          # Главный файл, который запускает сервер
internal/
  handler/           # Обработка HTTP запросов
  service/           # Проверка доступности ссылок
  queue/             # Очередь задач (для фоновой обработки)
  storage/           # Сохранение данных в файл
  pdf/               # Генерация PDF отчетов
pkg/types/           # Типы данных
tests/               # Скрипты для тестирования
reports/             # Папка для PDF отчетов
```

### Основные части

**Storage** - сохраняет все данные в файл `state.json`. При перезапуске сервера данные загружаются обратно.

**Checker** - проверяет доступность ссылок через HTTP запросы. Если ссылка отвечает, она доступна.

**Handler** - обрабатывает запросы от пользователей. Принимает JSON, возвращает JSON или PDF.

**Queue** - очередь для фоновой обработки задач. Сейчас не очень активно используется, но оставили на будущее.

**PDF Generator** - создает PDF файлы с отчетами о статусах ссылок.

## Как запустить

### Что нужно

- Go версии 1.21 или новее

### Установка зависимостей

```bash
go mod download
```

### Запуск

```bash
go run cmd/server/main.go
```

Сервер запустится на порту 8080. Можно изменить порт через переменную окружения `PORT`.

## Как проверить работу

### Запуск сервера

В одном терминале запустите:
```bash
go run cmd/server/main.go
```

Или скомпилируйте и запустите:
```bash
go build -o server.exe ./cmd/server
./server.exe
```

### Тестирование

**Автоматический тест (PowerShell):**
```powershell
powershell -ExecutionPolicy Bypass -File tests/test.ps1
```

**Автоматический тест (Linux/Mac):**
```bash
chmod +x tests/test.sh
./tests/test.sh
```

**Ручная проверка:**

1. Проверка ссылок:
```powershell
Invoke-RestMethod -Uri http://localhost:8080/submit -Method POST -ContentType "application/json" -Body '{"links": ["google.com", "yandex.ru"]}'
```

2. Получение PDF:
```powershell
Invoke-RestMethod -Uri http://localhost:8080/report -Method POST -ContentType "application/json" -Body '{"links_list": [1]}' -OutFile reports/report_1.pdf
```

PDF файлы сохраняются в папку `reports/`.

## Важные моменты

1. **Файл state.json** - там хранятся все данные. Если удалить файл, данные потеряются, но сервер продолжит работать.

2. **Проверка ссылок** - выполняется сразу при запросе. Статусы возвращаются в ответе.

3. **Остановка сервера** - при нажатии Ctrl+C сервер корректно завершит работу и сохранит все данные в файл.

4. **Перезапуск** - при перезапуске все данные загружаются из файла state.json.

## Зависимости

- `github.com/jung-kurt/gofpdf` - для создания PDF файлов

Остальное - стандартная библиотека Go.
